<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Packaging Python code &mdash; Data Transforms 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documenting Python code" href="writing_documentation.html" />
    <link rel="prev" title="Code and file structure" href="code_structure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Data Transforms
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setting the Stage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Collaborative Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_task.html">The task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Workshop Notes:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="good_coding_practices.html">Good coding practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="github_with_collaborators.html">Using GitHub with collaborators</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Code and file structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Packaging Python code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-build-system">The build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-source-code-structure">The source code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-dependency-versions">Setting dependency versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-your-package-locally">Installing your package locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning-your-package">Versioning your package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-artifacts">Build artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-upload">Build upload</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing_documentation.html">Documenting Python code</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_driven_development.html">Test driven development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">data_transforms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Data Transforms</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Packaging Python code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/packaging_python_code.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="packaging-python-code">
<h1>Packaging Python code<a class="headerlink" href="#packaging-python-code" title="Permalink to this headline"></a></h1>
<p>This section of notes is partially adapted from <a class="reference external" href="https://github.com/cameron-simpson/css/blob/pypi/doc/pypa-the-missing-outline.md">https://github.com/cameron-simpson/css/blob/pypi/doc/pypa-the-missing-outline.md</a></p>
<p>A python package is the process of collecting your code in a way that can be installed on a different person’s computer.  This process is made up of several parts:</p>
<ul class="simple">
<li><p>The source code</p></li>
<li><p>A configuration file with the package’s metadata (a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file)</p></li>
<li><p>Build artifacts that are uploaded to a package distribution service such as <a class="reference external" href="https://pypi.org/">PyPI</a>.  These are typically a source distribution (sdist) and a built distribution (wheel).</p></li>
</ul>
<section id="the-build-system">
<h2>The build system<a class="headerlink" href="#the-build-system" title="Permalink to this headline"></a></h2>
<p>To build your package you will need to pick a build system.  There are no build systems that come with python by default.  In the past <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> was the defacto standard, but in recent years more have become available.  For this workshop we will be using <a class="reference external" href="https://flit.pypa.io/en/latest/">flit</a> as it is lightweight and compliant with the latest python standards.</p>
<p>A build system typically comes with a command line interface (CLI) that can automate common tasks such as making a new python environment with you code installed, bumping your code’s version number, building the <code class="docutils literal notranslate"><span class="pre">sdist</span></code> and <code class="docutils literal notranslate"><span class="pre">wheel</span></code>s, or uploading the builds to PyPI.</p>
<p>Common build systems are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://flit.pypa.io/en/latest/">flit</a>: just a build system, nothing more</p></li>
<li><p><a class="reference external" href="https://hatch.pypa.io/latest/">hatch</a>: build system and environment management</p></li>
<li><p><a class="reference external" href="https://pdm.fming.dev/latest/">pdm</a>: build system, dependency management, dependency locking, and environment management (note: the environments are handled in the background so you don’t have to do it by hand)</p></li>
<li><p><a class="reference external" href="https://python-poetry.org/docs">poetry</a>: build system, dependency management, dependency locking, and environment management (note: not <a class="reference external" href="https://peps.python.org/pep-0621/">PEP 621</a> compliant, but it is on their long-term <a class="reference external" href="https://github.com/python-poetry/roadmap/issues/3">feature road map</a>)</p></li>
</ul>
<p>Each of these build systems have different workflows when managing your python package, it can be useful to try some of them out and see what one fits your project best.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Python’s packaging landscape is currently (Summer 2022) in flux.  You will find many out of date tutorials around making a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and/or <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> instead of/in addition to the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.  As of <a class="reference external" href="https://peps.python.org/pep-0621/">PEP 621</a> (approved in 2021), the method outlined in these notes is the “approved python” way of making a package going forward.  As of <code class="docutils literal notranslate"><span class="pre">pip</span></code> version 22.1.2 this new way of packaging is fully supported.</p>
</div>
</section>
<section id="the-source-code-structure">
<h2>The source code structure<a class="headerlink" href="#the-source-code-structure" title="Permalink to this headline"></a></h2>
<p>This workshop’s repository is already setup to be a python package let’s take a closer look at the structure.  The minimum files for this workshop’s code are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>DISCnet_workshop (git repository)
├── data_transforms (python package base folder)
│   ├── __init__.py (needed in every folder of the package, run on folder import)
│   ├── angle_metric.py (code file)
│   └── tests (folder to hold tests)
│       ├── __init__.py
│       └── test_angle_metric.py (test file)
├── LICENSE (make sure you license your code)
├── README.md (shown on the github page)
└── pyproject.toml (contains package metadata and dependencies)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>: A python package treats every folder as a class with this file as the initialization function, useful for pulling functions from the files and folders inside this folder into the top level namespace.  The top level <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> typically also stores the package <code class="docutils literal notranslate"><span class="pre">__version__</span></code> variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LICENSE</span></code>: You should choose a license for your code. <a class="reference external" href="https://choosealicense.com/">Choose A License</a> is a good resource for figuring out what license is best for your project.  The typical ones seen for research code are the <a class="reference external" href="https://choosealicense.com/licenses/mit/">MIT license</a> and <a class="reference external" href="https://choosealicense.com/licenses/apache-2.0/">Apache 2.0 license</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>: This file tells python how to install your code, what dependencies to install, and various development configuration options.  You can use <code class="docutils literal notranslate"><span class="pre">flit</span> <span class="pre">init</span></code> to help build this file or just write it by hand.</p></li>
</ul>
</section>
<section id="setting-dependency-versions">
<h2>Setting dependency versions<a class="headerlink" href="#setting-dependency-versions" title="Permalink to this headline"></a></h2>
<p>To help with code reproducibility and dependency compatibility you can should pin dependency versions to a single value or a range.  It is python convention that the dependencies in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> are pinned as <strong>ranges</strong> to ensure they are easy to install into existing environments and not collide with the dependencies of other packages installed.  An optional file (either <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or the lock file created by your build tool) is used to pin down <strong>exact</strong> package versions when reproducibility is important (e.g. all developers wanting to have the same versions of all dependencies installed or keeping a record of the package versions installed when a paper was published using the code).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most python packages use <a class="reference external" href="https://semver.org/">semantic versioning</a>.  This means the version numbers are set as MAJOR.MINOR.PATCH</p>
<ul class="simple">
<li><p>MAJOR version increments when incompatible API changes are made to the code</p></li>
<li><p>MINOR version increments when a new feature is added in a backward compatible manner</p></li>
<li><p>PATCH version increments when a backward compatible bug fix is made</p></li>
</ul>
</div>
<p>The rule of thumb I use when pinning down my packages ranges:</p>
<ul class="simple">
<li><p>Set the lower bound as <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> the exact version currently installed in my environment (use <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span></code> to view the current versions of installed packages)</p></li>
<li><p>Set the upper bound as <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> the next patch fix version of the package</p></li>
<li><p>Activate <a class="reference external" href="https://github.blog/2020-06-01-keep-all-your-packages-up-to-date-with-dependabot/">dependabot</a> on GitHub to automatically make pull requests that update the upper bound when dependencies update (this will trigger our CI to run our tests automatically and let us know if the update breaks the code)</p>
<ul>
<li><p>If a dependency update breaks the code (typically major version updates), update the code and set the lower bound to be the latest version of the dependency</p></li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Related to the current changing landscape of Python packaging the packaging method in this workshop is <a class="reference external" href="https://github.com/dependabot/dependabot-core/issues/3290">not yet supported</a> by <code class="docutils literal notranslate"><span class="pre">dependabot</span></code>.  Hopefully it will be updated soon.  For now I have left the <code class="docutils literal notranslate"><span class="pre">dependabot</span></code> setup on this repository to show what it will look like once it is working again.  Dependabot currently works when dependencies are defined in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, the old <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, or using <code class="docutils literal notranslate"><span class="pre">poetry</span></code>s version of a <code class="docutils literal notranslate"><span class="pre">pyporject.toml</span></code> file.</p>
</div>
</section>
<section id="installing-your-package-locally">
<h2>Installing your package locally<a class="headerlink" href="#installing-your-package-locally" title="Permalink to this headline"></a></h2>
<p>When you install a python package it will typically involve copying the python files to your <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> directory.  Running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.[dev]</span></code> in the top level directory (same folder as the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file) will do just this.  If you are actively developing your code and want to test out your latest changes you would need to reinstall the code with every change, this can become tedious.</p>
<p>To help developers, <code class="docutils literal notranslate"><span class="pre">pip</span></code> also has the ability to install a package in “edit” mode, this creates a symbolic link in <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> that points to your source code, that way change can be seen without needing to reinstall the code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .<span class="o">[</span>dev<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="versioning-your-package">
<h2>Versioning your package<a class="headerlink" href="#versioning-your-package" title="Permalink to this headline"></a></h2>
<p>It is a good idea to use single-source package versioning, this means the package version is defined in exactly one place inside the repository.  For python this is typically inside the top level <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file and stored with the variable name <code class="docutils literal notranslate"><span class="pre">__version__</span></code>.  <code class="docutils literal notranslate"><span class="pre">flit</span></code> will automatically pull the version number from this place and use it in the <code class="docutils literal notranslate"><span class="pre">pyporject.toml</span></code> file (this is why “version” is listed in the <code class="docutils literal notranslate"><span class="pre">dynamic</span></code> section)</p>
<p>When you are ready to release a new version of your code make a new PR that only bumps the version number using semantic versioning (see note above).  Once merged add a git tag to the merge commit.  You can also add additional notes about the release when making the tag, this a good place to include what things have changed in the new release.</p>
<p>For larger projects it is worth keeping a separate <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> file inside the repository or a changelog section in the <code class="docutils literal notranslate"><span class="pre">README.md</span></code> that tracks all the changes introduced in each version bump to make this information easier to find.  There are tools available to help automate this process, these typically involve using special keywords when writing git commit messages to flag up text related to new features and/or breaking changes (e.g. <a class="reference external" href="https://github.com/KeNaCo/auto-changelog">auto-changelog</a>).</p>
</section>
<section id="build-artifacts">
<h2>Build artifacts<a class="headerlink" href="#build-artifacts" title="Permalink to this headline"></a></h2>
<p>If/when you are ready to upload your files to <code class="docutils literal notranslate"><span class="pre">PyPI</span></code> you first need to crete the files that will be uploaded.  These can be done with our chosen build tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flit build
</pre></div>
</div>
<p>This will create two files in the <code class="docutils literal notranslate"><span class="pre">dist</span></code> subdirectory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_transforms-0.1.0.tar.gz</span></code>: this is the <code class="docutils literal notranslate"><span class="pre">sdist</span></code> file, a normal zip folder with the source code inside</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_transforms-0.1.0-py3-none-any.whl</span></code>: this is the <code class="docutils literal notranslate"><span class="pre">wheel</span></code> file, also a zip folder with the pre-compiled code inside (if you code is pure python it will be basically identical to the <code class="docutils literal notranslate"><span class="pre">sdist</span></code>s contents)</p></li>
</ul>
<p>The code version number is automatically used in the build names, this prevents older code version from being overwritten when the version is updated.</p>
</section>
<section id="build-upload">
<h2>Build upload<a class="headerlink" href="#build-upload" title="Permalink to this headline"></a></h2>
<p>To publish your package to <a class="reference external" href="https://pypi.org/">PyPI</a> you will first need to create an account.  Once created you can use your build tool or <a class="reference external" href="https://twine.readthedocs.io/en/stable/">twine</a> to upload your build artifacts.  For uploading with <code class="docutils literal notranslate"><span class="pre">flit</span></code> see their docs <a class="reference external" href="https://flit.pypa.io/en/latest/upload.html">https://flit.pypa.io/en/latest/upload.html</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The build and upload systems can be written into a GHA that triggers when a new version is tagged so you never forget the step of releasing your code to the public.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="code_structure.html" class="btn btn-neutral float-left" title="Code and file structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="writing_documentation.html" class="btn btn-neutral float-right" title="Documenting Python code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Coleman Krawczyk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>